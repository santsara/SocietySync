<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>Solved Queries - SocietySync</title>

    <style>

        /* ... (CSS remains unchanged) ... */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body { background: linear-gradient(135deg, #FFF0D3, #FFF9EE); min-height: 100vh; }

        .banner { background-color: #4d2822; color: #FFF9EE; padding: 20px; text-align: center; position: relative; width: 100%; box-sizing: border-box; margin-bottom: 50px; }

        .banner-title { font-size: 28px; font-weight: bold; }

        .back-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); width: 75px; height: 75px; }

        

        /* Query Card Styles */

        .query-container { max-width: 900px; margin: 0 auto; padding: 0 20px; }

        .query-card { background-color: #FFF9EE; padding: 20px; border-left: 5px solid #2E8B57; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); margin-bottom: 25px; }

        .query-card h3 { color: #4d2822; margin-bottom: 10px; font-size: 20px; }

        .query-meta { font-size: 13px; color: #666; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 5px; }

        .query-description { margin-top: 10px; color: #444; line-height: 1.5; }

        

        .solution-section { margin-top: 15px; padding: 15px; background: #e6f7ef; border-radius: 5px; border-left: 3px solid #2E8B57; }

        .solution-section h4 { color: #246b45; margin-bottom: 5px; font-size: 16px; }

        .solution-meta { font-style: italic; font-size: 12px; margin-top: 10px; color: #666; }

    </style>

</head>

<body>

    <header class="banner">

        <h1>Quick Resolve </h1>

        <p>Questions Answered!</p>

        <a href="quickResolve.html">

        <img src="Images/Back to qR.png" alt="Back to Quick Resolve" class="back-icon">

        </a>

    </header>

    

    <div id="queryList" class="query-container">

        <p style="text-align: center; color: #4d2822;">Loading solved queries...</p>

    </div>

    

    <script defer>

    document.addEventListener('DOMContentLoaded', fetchSolvedQueries);



    async function fetchSolvedQueries() {

        const queryListDiv = document.getElementById('queryList');

        queryListDiv.innerHTML = '<p style="text-align: center; color: #4d2822; padding: 30px;">Loading solved queries...</p>';



        // Utility function to safely format dates

        const formatDate = (dateTimeString) => {

            if (!dateTimeString) return 'N/A';

            try {

                const date = new Date(dateTimeString);

                if (isNaN(date.getTime())) return dateTimeString; // FIX: use getTime() for robust check



                return date.toLocaleDateString('en-IN', { 

                    year: 'numeric', month: 'short', day: 'numeric',

                    hour: '2-digit', minute: '2-digit', hour12: true

                });

            } catch (e) {

                return dateTimeString;

            }

        };



        try {

            const res = await fetch("/api/quickresolve/solved");

            

            if (!res.ok) {

                // Read server error message if available

                const errorData = await res.json().catch(() => ({ message: 'Unknown server error.' }));

                throw new Error(errorData.message || 'Server error occurred while fetching solved queries.');

            }

            

            const queries = await res.json();

            

            queryListDiv.innerHTML = ''; // Clear loading message



            if (queries.length === 0) {

                queryListDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 30px;">There are no solved queries available in the archive yet.</p>';

                return;

            }



            queries.forEach(query => {

                // Ensure null/undefined fields are handled gracefully

                const residentName = query.residentName || 'N/A';

                const residentFlatNo = query.residentFlatNo || 'N/A';

                const dateRaised = query.dateRaised || 'N/A';

                const committeeAnswer = query.committeeAnswer || 'No answer text provided.';

                const answeredBy = query.answeredBy || 'N/A';

                const dateSolved = query.dateSolved || 'N/A';



                const card = document.createElement('div');

                card.classList.add('query-card');



                card.innerHTML = `

                    <h3>âœ… ${query.title} (ID: ${query.id})</h3>

                    <p class="query-meta">

                        Raised by: <strong>${residentName}</strong> | Flat: <strong>${residentFlatNo}</strong> | ${formatDate(dateRaised)}

                    </p>

                    <p class="query-description">

                        <strong>Resident Query:</strong> ${query.description}

                    </p>

                    <div class="solution-section">

                        <h4>Resolution Provided:</h4>

                        <p>${committeeAnswer}</p>

                        <p class="solution-meta">

                            Resolved by: <strong>${query.answeredBy}</strong> on ${formatDate(dateSolved)}

                        </p>

                    </div>

                `;

                queryListDiv.appendChild(card);

            });

        } catch (err) {

            console.error("Fetch solved queries failed:", err);

            // Display a more informative error message to the user

            queryListDiv.innerHTML = `<p style="text-align: center; color: red; padding: 30px;">Error loading solved queries: ${err.message}. Please check the server.</p>`;

        }

    }

</script>

</body>

</html>