<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SocietySync - Home</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        /* Reset */ 
*
{ 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
} 
/* Body Background */ 
body
{ 
    background: radial-gradient(circle, #FFF0D3, #FFF9EE); 
    display: flex; 
    flex-direction: column; 
    min-height: 100vh; 
} 
/* Banner */ 
.banner
{ 
    background-color: #4d2822; 
    color: #FFF9EE; 
    padding: 20px; 
    text-align: center; 
    position: relative;
    margin: 0; 
    width: 100%;
    min-height: 30vh; 
    display: flex;
    align-items: center;
    justify-content: center;
} 
.banner-icon
{ 
    position: absolute; 
    left: 20px; 
    top: 65%; 
    transform: translateY(-50%); 
    width: 70px; 
    height: 70px; 
} 
.banner-title
{ 
    font-size: 40px; 
    font-weight: bold;
    color:#FFF9EE;
    margin: 0;
    min-height: 100px; 
    padding-top: 50px;
}
        .top-section {
            position: relative;
            flex: 1 1 33vh;
            min-height: 33vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .icon-container
        {
            width: 100%;
            display: flex;
            justify-content: flex-start; /* left aligned, across width */
            padding-left: 30px; /* spacing from left and top */
            padding-top: 5px;
            box-sizing: border-box; 
        }
        .user-circle
        {
            position: relative;
            width: 48px;
            height: 48px;
            background-color: #FFF0D3;
            border-radius: 50%;
            border: 2px solid #4d2822;
            cursor: pointer;
            outline: none;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 22px;
            user-select: none;
            padding: 20px; 
        }
        .user-icon
        {
            position: relative;
            font-size: 24px;  /* slightly smaller than circle */
            pointer-events: none;
            left: 85px;
            bottom: 5px;
        }
        .bottom-section {
            flex: 2 1 67vh;
            min-height: 67vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .welcome-home {
            color: #4d2822;
            font-size: larger;
            font-weight: 600;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 8px;
        }
        .welcome-home h1 {
            font-size: 70px;
            color: #4d2822;
            font-weight: 800;
            letter-spacing: 1.5px;
            margin: 0 0 3px 0;
        }
        .welcome-home p {
            font-size: 22px;
            color: #4d2822;
            margin-top: 2px;
            font-weight: 500;
        }
        .carousel-container {
            display: flex;
            align-items: center;
            
            width: 900px;
            height: 300px;
            box-sizing: border-box;
            margin: 10px;
            border-radius: 25px;
            border: 2px solid #4d2822;
            box-shadow: 0 12px 28px rgba(77,40,34,.09), 0 3px 6px rgba(77,40,34,.06);
            background: #FFF0D3;
        }
        .carousel-arrow {
            background: #FFF0D3;
            color: #4d2822;
            border: none;
            border-radius: 50%;
            width: 38px;
            height: 38px;
            font-size: 20px;
            cursor: pointer;
            transition: background 0.25s;
            z-index: 2;
        }
        .carousel-arrow:hover {
            background: #FFF9EE;
        }
        .carousel-track {
            overflow: hidden;
            width: 870px;
            height: 100%;
            display: flex;
            align-items: center;
        }
        .features-grid {
            align-content: center;
            display: flex;
            gap: 40px;
            min-width: 800px;
            height: 100%;
            transition: transform 0.5s cubic-bezier(.67,1.49,.36,.78);
            padding: 35px;
            box-sizing: border-box;
        }
        .feature-card {
            width: 225px;
            min-width: 225px;
            height: 225px;
            background-color: #FFF9EE;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            transition: transform 0.3s ease;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .feature-card img {
            width: 140px;
            height: 140px;
            margin: 0 auto 10px auto;
            display: block;
        }
        .feature-card h3 {
            font-size: 18px;
            color: #4d2822;
            margin-bottom: 10px;
        }
        .feature-card p {
            font-size: 14px;
            color: #4d2822;
        }
        img {
            width: 100%;
            height: 100%;
            object-fit: contain;  /* or 'cover' depending on cropping needs */
        }

        a.option-card {
            text-decoration: none;
        }
        a, a:visited, a:hover, a:active {
            text-decoration: none;
        }
        @media (max-width: 1024px) {
            .carousel-container, .carousel-track { width: 100%; min-width: 0; }
        }
        @media (max-width: 900px) {
            .carousel-container { width: 97vw; }
            .carousel-track { width: 90vw; }
            .features-grid { gap: 25px; }
            .feature-card { min-width: 180px; height: 300px; }
        }
        @media (max-width: 700px) {
            .carousel-container { width: 100vw; }
            .carousel-track { width: 300px; }
            .features-grid { min-width: 300px; }
            .feature-card { min-width: 90vw; }
        }
        
        

.user-circle:hover,
.user-circle:focus
{
    background-color: #8b3a3a;
}

.user-circle::before
{
    content: usericon; /* initials or user icon */
    pointer-events: none;
}

.tooltip-text
{
    position: relative;
    top: 20px;  /* beneath circle */
    left: 100px;
    background-color: #4d2822;
    color: #fff9ee;
    padding: 8px 12px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(77, 40, 34, 0.3);
    white-space: nowrap;
    font-size: 17px;
    opacity: 0;
    pointer-events: none;
    transform: translateY(-10px);
    transition: opacity 0.3s, transform 0.3s;
    z-index: 10;
}

.user-circle:hover .tooltip-text,
.user-circle:focus .tooltip-text
{
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}
</style>
</head>
<body>
    <div class="top-section">
        <header class="banner">
            <img src="Images/Society Sync.png" alt="Society Sync Icon" class="banner-icon" />
            <h1 class="banner-title">SocietySync</h1>
        </header>
        <div class="icon-container">
            <button class="user-circle" aria-label="User info" type="button">
                <span class="user-icon">&#128100;</span>
                <span class="tooltip-text">
                    <span id="tooltip-name">Fname Lname</span><br>
                    <span id="tooltip-flat">Flat No. 101</span><br>
                    <span id="tooltip-mob">Mob: 1234567890</span>
                </span>
            </button>
        </div>
        <div class="welcome-home">
            <h2 id="greeting-name">Welcome Home!</h2>
            <p>Your society at a glance</p>
        </div>
    </div>
    <div class="bottom-section">
        <div class="carousel-container">
            <button class="carousel-arrow left" id="carouselPrev">&#8592;</button>
            <div class="carousel-track">
                <div class="features-grid">
                    <a href="fundFlow.html" class="feature-card">
                        <img src="Images/Fund Flow.png" alt="Fund Flow Icon" />
                        <h3>Fund Flow</h3>
                    </a>
                    <a href="sectoralDistribution.html" class="feature-card">
                        <img src="Images/Sectoral Distribution.png" alt="Sectoral Distribution Icon" />
                        <h3>Sectoral Distribution</h3>
                    </a>
                    <a href="noticeboard.html" class="feature-card">
                        <img src="Images/Cultural Updates.png" alt="Cultural Updates Icon" />
                        <h3>Notice Board</h3>
                    </a>
                    <a href="societyConnect.html" class="feature-card">
                        <img src="Images/Society Connect.png" alt="Society Connect Icon" />
                        <h3>Society Connect</h3>
                    </a>
                    <a href="quickResolve.html" class="feature-card">
                        <img src="Images/Quick Resolve.png" alt="Quick Resolve Icon" />
                        <h3>Quick Resolve</h3>
                    </a>
                    <a href="civicCircle.html" class="feature-card">
                        <img src="Images/Civic Circle.png" alt="Civic Circle Icon" />
                        <h3>Civic Circle</h3>
                    </a>
                </div>
            </div>
            <button class="carousel-arrow right" id="carouselNext">&#8594;</button>
        </div>
    </div>
    <script>
        console.log("Homepage loaded");
        
        // ⭐ NEW: FUNCTION TO FETCH AND DISPLAY USER DATA ⭐
        async function fetchAndDisplayUserData() {
            try {
                // Call the Spring Boot API endpoint 
                const response = await fetch('/api/signup/details'); 
                
                if (response.status === 401) {
                    console.log("User not logged in. Displaying default data.");
                    return; 
                }
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const userData = await response.json(); 

                // --- Format Data for Display ---
                const fullName = userData.fullName || 'Resident'; 
                // Extract only the first word for a friendly greeting
                const firstName = fullName.split(' ')[0];
                const flatInfo = `Flat No. ${userData.flatNo || 'N/A'}`;
                const mobileInfo = `Mob: ${userData.mobileNo || 'N/A'}`;


                // --- Update the DOM ---
                
                // 1. Update the Main Greeting
                const greetingElement = document.getElementById('greeting-name');
                if (greetingElement) {
                    greetingElement.textContent = `Welcome Home, ${firstName}!`;
                }

                // 2. Update the Tooltip Content
                document.getElementById('tooltip-name').textContent = fullName;
                document.getElementById('tooltip-flat').textContent = flatInfo;
                document.getElementById('tooltip-mob').textContent = mobileInfo;

            } catch (error) {
                console.error("Error fetching user data:", error);
                // Keep default placeholder data on error
            }
        }
        // -----------------------------------------------------

        // Wait until the DOM is loaded
        document.addEventListener("DOMContentLoaded", function() {
            let currentIndex = 0;
            const cardsPerView = 3;
            const cards = document.querySelectorAll('.feature-card');
            const featuresGrid = document.querySelector('.features-grid');
            const totalCards = cards.length;
            // Note: The visibility check for carouselNext was slightly incorrect, updated to check against maxIndex
            const maxIndex = Math.ceil(totalCards / cardsPerView) - 1; 

            function updateCarousel() {
                const cardWidth = cards[0].offsetWidth + 45;
                const shift = -(currentIndex * cardsPerView * cardWidth);
                featuresGrid.style.transform = `translateX(${shift}px)`;
                
                document.getElementById('carouselPrev').style.visibility = currentIndex === 0 ? 'hidden' : 'visible';
                document.getElementById('carouselNext').style.visibility = currentIndex >= maxIndex ? 'hidden' : 'visible';
            }

            document.getElementById('carouselPrev').addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateCarousel();
                }
            });
            document.getElementById('carouselNext').addEventListener('click', () => {
                if (currentIndex < maxIndex) {
                    currentIndex++;
                    updateCarousel();
                }
            });

            // ⭐ RUN THE NEW FUNCTION ON LOAD
            fetchAndDisplayUserData(); 
            
            window.addEventListener('resize', updateCarousel);
            updateCarousel(); // Initial call to set up the carousel state
            
            // Note: The previous logic for card event listeners was removed as the <a> tags already handle navigation.
        });
    </script>
</body>
</html>